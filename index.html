<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Zorgstart ‚Äî Ontslagmanagementsflow</title>

<style>
:root{
  --bg:#0b1220;
  --bg2:#070b14;
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.70);
  --stroke:rgba(255,255,255,.12);
  --shadow:0 18px 55px rgba(0,0,0,.45);
  --shadow2:0 10px 26px rgba(0,0,0,.28);

  --blue:#5dd6ff;
  --purple:#7c5cff;
  --green:#48d597;
  --amber:#ffd166;
  --red:#ff6b6b;

  --r:18px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--sans);
  color:var(--text);
  background:
    radial-gradient(1100px 700px at 15% 6%, rgba(93,214,255,.18), transparent 60%),
    radial-gradient(950px 700px at 88% 10%, rgba(124,92,255,.20), transparent 62%),
    radial-gradient(900px 700px at 30% 92%, rgba(255,209,102,.10), transparent 60%),
    linear-gradient(180deg, var(--bg2) 0%, var(--bg) 45%, var(--bg2) 100%);
  overflow-x:hidden;
}

.gridbg{
  position:fixed; inset:0;
  background-image:
    linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(closest-side at 50% 35%, rgba(0,0,0,.65), transparent 85%);
  pointer-events:none;
  opacity:.55;
}

.wrap{max-width:1240px;margin:0 auto;padding:30px 18px 90px;}

header{
  display:flex;gap:14px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;
  margin-bottom:18px;
}
.pill{
  display:inline-flex;gap:10px;align-items:center;
  padding:8px 12px;border:1px solid var(--stroke);
  background:rgba(255,255,255,.04);
  border-radius:999px;backdrop-filter: blur(10px);
  box-shadow: var(--shadow2);
}
.dot{
  width:10px;height:10px;border-radius:999px;
  background: linear-gradient(135deg, var(--blue), var(--purple));
  box-shadow:0 0 0 6px rgba(93,214,255,.12);
}
h1{
  margin:10px 0 4px;
  font-size:clamp(26px,3.1vw,40px);
  letter-spacing:-0.02em;
  line-height:1.06;
}
.sub{
  margin:0;
  color:var(--muted);
  line-height:1.45;
  max-width:980px;
  font-size:15.5px;
}

.actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

.btn{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.05);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  transition:transform .15s ease, background .15s ease, border-color .15s ease;
  box-shadow:var(--shadow2);
  font-weight:800;
  letter-spacing:.01em;
}
.btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.08);border-color:rgba(93,214,255,.35)}
.btn:active{transform:translateY(0) scale(.99)}

.btn.primary{
  border-color: rgba(93,214,255,.45);
  background: rgba(93,214,255,.10);
}

.kbd{
  font-family:var(--mono);
  font-size:12px;
  opacity:.85;
  padding:2px 8px;
  border-radius:10px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.18);
}

.panel{
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
  margin-top:14px;
}

.head{
  padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
}

.title{
  display:flex;gap:10px;align-items:center;
  font-weight:900;letter-spacing:-.01em;
}

.badge{
  font-size:12px;padding:4px 10px;border-radius:999px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.05);
  color:var(--muted);
}

.legend{
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;color:var(--muted);font-size:12px;
}
.leg{
  display:inline-flex;align-items:center;gap:8px;
  border:1px solid rgba(255,255,255,.09);
  padding:6px 10px;border-radius:999px;
  background:rgba(0,0,0,.10);
}
.swatch{width:10px;height:10px;border-radius:999px;outline:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.22)}
.swatch.blue{background:linear-gradient(135deg,var(--blue),#2fb7ff)}
.swatch.purple{background:linear-gradient(135deg,var(--purple),#a389ff)}
.swatch.green{background:linear-gradient(135deg,var(--green),#20c997)}
.swatch.amber{background:linear-gradient(135deg,var(--amber),#ff9f1c)}
.swatch.red{background:linear-gradient(135deg,var(--red),#ff3b3b)}

.section{padding:14px}

.grid2{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:1020px){.grid2{grid-template-columns:1fr 1fr}}

.block{
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  background:rgba(0,0,0,.12);
  padding:14px;
  position:relative;
  overflow:hidden;
}
.block::before{
  content:"";
  position:absolute;inset:-80px;
  background:
    radial-gradient(closest-side at 20% 15%, rgba(93,214,255,.10), transparent 55%),
    radial-gradient(closest-side at 75% 35%, rgba(124,92,255,.12), transparent 60%);
  opacity:.9;pointer-events:none;
}
.block h3{
  margin:0 0 10px;
  font-size:16px;
  position:relative;z-index:1;
  display:flex;justify-content:space-between;gap:10px;align-items:center;
}
.mini{font-size:12px;color:var(--muted);font-weight:800;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.tag{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);padding:4px 8px;border-radius:999px}

.nodes{display:grid;gap:10px;position:relative;z-index:1}

.node{
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  padding:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.22);
  display:flex;gap:12px;align-items:flex-start;
  cursor:pointer;
  transition:transform .18s ease,border-color .18s ease,background .18s ease,opacity .18s ease;
}
.node:hover{transform:translateY(-2px);border-color:rgba(93,214,255,.38);background:rgba(255,255,255,.085)}
.icon{
  width:34px;height:34px;border-radius:12px;
  display:grid;place-items:center;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.05);
  flex:0 0 auto;
}
.icon.blue{border-color:rgba(93,214,255,.25);background:rgba(93,214,255,.12)}
.icon.purple{border-color:rgba(124,92,255,.25);background:rgba(124,92,255,.14)}
.icon.green{border-color:rgba(72,213,151,.25);background:rgba(72,213,151,.12)}
.icon.amber{border-color:rgba(255,209,102,.25);background:rgba(255,209,102,.12)}
.icon.red{border-color:rgba(255,107,107,.25);background:rgba(255,107,107,.12)}
.icon svg{width:18px;height:18px;opacity:.95}

.node b{display:block;font-size:14px;letter-spacing:-.01em;margin-bottom:4px}
.node p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
.node small{display:block;margin-top:6px;color:rgba(255,255,255,.70);font-family:var(--mono);font-size:11.5px;opacity:.9}

.arrow{height:18px;display:grid;place-items:center;opacity:.75}
.arrow svg{width:16px;height:16px;animation:bob 1.6s ease-in-out infinite}
@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(3px)}}

hr.sep{border:0;border-top:1px dashed rgba(255,255,255,.16);margin:12px 0}
.flex{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

.details{
  margin-top:10px;padding:12px;border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);
  display:none;
}
.details.show{display:block}
.details h4{margin:0 0 8px;font-size:14px;color:rgba(255,255,255,.90)}
.details ul{margin:0;padding-left:18px;color:var(--muted)}
.details li{margin:6px 0}

.pulse{animation:pulse 1.1s ease-in-out 1}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(93,214,255,.0)}
  30%{box-shadow:0 0 0 10px rgba(93,214,255,.10)}
  100%{box-shadow:0 0 0 0 rgba(93,214,255,.0)}
}

/* Timeline */
.timeline{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:1020px){.timeline{grid-template-columns:1.2fr .8fr}}
.sliderRow{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
input[type="range"]{width:min(540px,100%)}
.timeLabel{
  font-family:var(--mono);
  font-size:12px;
  padding:5px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.16);
  color:rgba(255,255,255,.86);
}
.docgrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(min-width:1020px){.docgrid{grid-template-columns:repeat(3,minmax(0,1fr))}}
.doc{
  border-radius:14px;border:1px solid rgba(255,255,255,.11);
  background:rgba(255,255,255,.05);
  padding:10px;box-shadow:0 10px 22px rgba(0,0,0,.18);
  opacity:.55;
  transition:opacity .18s ease,transform .18s ease,border-color .18s ease;
}
.doc.on{opacity:1;transform:translateY(-1px);border-color:rgba(72,213,151,.35)}
.doc b{display:block;font-size:13px;margin-bottom:5px}
.doc span{font-family:var(--mono);font-size:11.5px;color:rgba(255,255,255,.76)}

/* Stoplights */
.lights{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.light{
  width:14px;height:14px;border-radius:50%;
  background:rgba(255,255,255,.20);
  border:1px solid rgba(255,255,255,.18);
  cursor:pointer;
  position:relative;
}
.light::after{
  content:attr(data-l);
  position:absolute;top:-24px;left:50%;
  transform:translateX(-50%);
  font-family:var(--mono);
  font-size:10.5px;
  color:rgba(255,255,255,.75);
  opacity:0;transition:opacity .15s ease;white-space:nowrap;
}
.light:hover::after{opacity:1}
.light.med{background:rgba(255,209,102,.35)}
.light.hosp{background:rgba(124,92,255,.35)}
.light.home{background:rgba(93,214,255,.35)}
.light.ok{background:rgba(72,213,151,.55);border-color:rgba(72,213,151,.55)}
.statusLine{font-family:var(--mono);font-size:12px;color:rgba(255,255,255,.78)}

/* Lexicons */
.lexRow{display:flex;gap:10px;flex-wrap:wrap}
.lex{
  border-radius:999px;border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.05);
  padding:6px 10px;
  font-family:var(--mono);font-size:12px;
  color:rgba(255,255,255,.86);
  cursor:pointer;
  transition:transform .15s ease,border-color .15s ease,background .15s ease,opacity .15s ease;
  opacity:.7;
}
.lex:hover{transform:translateY(-1px);border-color:rgba(93,214,255,.35);background:rgba(255,255,255,.08);opacity:1}
.lex.on{opacity:1;border-color:rgba(93,214,255,.45);background:rgba(93,214,255,.10)}

/* Probleemgebieden (16) */
.pbGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(min-width:1020px){.pbGrid{grid-template-columns:repeat(4,minmax(0,1fr))}}
.pb{
  border-radius:14px;border:1px solid rgba(255,255,255,.11);
  background:rgba(124,92,255,.08);
  padding:10px;
  opacity:.45;
  transition:opacity .18s ease,transform .18s ease,border-color .18s ease;
}
.pb.on{opacity:1;transform:translateY(-1px);border-color:rgba(124,92,255,.40)}
.pb b{display:block;font-size:13px;margin-bottom:5px}
.pb span{font-family:var(--mono);font-size:11.5px;color:rgba(255,255,255,.76)}

/* Bundles (16) */
.bundleGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(min-width:1020px){.bundleGrid{grid-template-columns:repeat(4,minmax(0,1fr))}}
.bundle{
  border-radius:16px;border:1px solid rgba(255,255,255,.11);
  background:rgba(72,213,151,.08);
  padding:12px;
  box-shadow:0 10px 22px rgba(0,0,0,.18);
  opacity:.38;
  transition:opacity .18s ease,transform .18s ease,border-color .18s ease;
  cursor:pointer;
}
.bundle.on{opacity:1;transform:translateY(-1px);border-color:rgba(72,213,151,.35)}
.bundle b{display:block;margin-bottom:6px}
.bundle ul{margin:0;padding-left:16px;color:var(--muted);font-size:12.5px}
.bundle li{margin:4px 0}

/* Providers layer */
.provGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(min-width:1020px){.provGrid{grid-template-columns:repeat(4,minmax(0,1fr))}}
.prov{
  border-radius:16px;border:1px solid rgba(255,255,255,.11);
  background:rgba(93,214,255,.06);
  padding:12px;
  box-shadow:0 10px 22px rgba(0,0,0,.18);
  opacity:.40;
  transition:opacity .18s ease,transform .18s ease,border-color .18s ease;
}
.prov.on{opacity:1;transform:translateY(-1px);border-color:rgba(93,214,255,.40)}
.prov b{display:block;margin-bottom:6px}
.prov .meta{font-family:var(--mono);font-size:11.5px;color:rgba(255,255,255,.76)}
.prov .reason{margin-top:8px;color:var(--muted);font-size:12.5px;line-height:1.35}
.prov .status{
  display:inline-flex;align-items:center;gap:8px;margin-top:10px;
  font-family:var(--mono);font-size:11.5px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.12);
  padding:4px 8px;border-radius:999px;color:rgba(255,255,255,.82);
}
.prov .pilldot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.25)}
.prov.matching .pilldot{background:rgba(255,209,102,.75)}
.prov.matched .pilldot{background:rgba(72,213,151,.75)}
.prov.blocked .pilldot{background:rgba(255,107,107,.75)}

.publishBox{
  margin-top:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.16);
  padding:12px;
  display:none;
}
.publishBox.show{display:block}
.publishBox h4{margin:0 0 8px;font-size:14px}
.publishBox .row{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:1020px){.publishBox .row{grid-template-columns:1fr 1fr}}
.outCard{
  border-radius:14px;border:1px solid rgba(255,255,255,.11);
  background:rgba(255,255,255,.05);
  padding:10px;
}
.outCard b{display:block;margin-bottom:6px}
.outCard p{margin:0;color:var(--muted);font-size:12.8px;line-height:1.35}
.smallNote{color:var(--muted);font-size:12.5px;line-height:1.35}

.focus .node, .focus .doc, .focus .lex, .focus .pb, .focus .bundle, .focus .prov{opacity:.28 !important}
.focus .active{opacity:1 !important}

.reveal{opacity:0;transform:translateY(10px);transition:opacity .5s ease, transform .5s ease}
.reveal.in{opacity:1;transform:translateY(0)}

a.link{
  color: rgba(93,214,255,.95);
  text-decoration:none;
  border-bottom:1px dashed rgba(93,214,255,.45);
}
a.link:hover{opacity:.9}
</style>
</head>

<body>
<div class="gridbg" aria-hidden="true"></div>

<div class="wrap">
  <header class="reveal">
    <div style="max-width:980px">
      <div class="pill"><span class="dot"></span><span><b>Zorgstart</b> ‚Äî Dual Flow ‚Üí 16 Probleemgebieden ‚Üí 16 Bundels ‚Üí Zorgverleners ‚Üí Matching ‚Üí Zorgplan</span><span class="kbd">full</span></div>
      <h1>Alles visueel: PHR + vragenlijst + lexicons + bundels + zorgverleners + matching</h1>
      <p class="sub">
        1) Documenten worden gescrapet in <b>OnePatient (Bingli)</b> ‚Üí PHR/gestructureerde data.
        2) Context komt via <b>slimme vragenlijst</b>.
        3) <b>Lexicons</b> detecteren <b>16 probleemgebieden</b>.
        4) Zorgstart stelt <b>16 zorgbundels</b> voor incl. <b>medicatieschema</b>.
        5) Bundels mappen naar <b>aangewezen zorgverleners</b> en verwijzen naar het <b>matchmakingsplatform</b>.
      </p>
    </div>
    <div class="actions">
      <button class="btn primary" id="simulateAll">Simuleer demo</button>
      <button class="btn" id="toggleFocus">Focus mode</button>
      <button class="btn" id="reset">Reset</button>
      <span class="kbd">klik op elementen</span>
    </div>
  </header>

  <!-- TIMELINE -->
  <section class="panel reveal">
    <div class="head">
      <div class="title">
        <span class="swatch blue"></span><span>Documenten & timing</span><span class="badge">dag 0 ‚Üí 14</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch green"></span> beschikbaar</span>
        <span class="leg"><span class="swatch"></span> nog niet</span>
      </div>
    </div>

    <div class="section timeline">
      <div>
        <div class="sliderRow">
          <b>Timeline</b>
          <input type="range" id="day" min="0" max="14" value="1"/>
          <span class="timeLabel" id="dayLabel">Dag 1</span>
          <span class="kbd">sleep</span>
        </div>
        <p class="smallNote" style="margin:8px 0 0">
          Pre-planning start op dag 0‚Äì1; finalisatie in laatste 48u met ontslagbrief + finale medicatie + voorschriften.
        </p>
      </div>

      <div class="block" style="padding:12px">
        <h3 style="margin:0 0 10px;position:relative;z-index:1">üìÑ Beschikbare documenten (simulatie)</h3>
        <div class="docgrid">
          <div class="doc" data-doc="opname"><b>Opname-/spoedverslag</b><span>dag 0</span></div>
          <div class="doc" data-doc="problem"><b>Probleemlijst / EPD</b><span>dag 0‚Äì1</span></div>
          <div class="doc" data-doc="nursing"><b>Verpleegkundige inschatting</b><span>dag 1‚Äì2</span></div>
          <div class="doc" data-doc="paramed"><b>Kine/Ergo/Logopedie</b><span>dag 2‚Äì3</span></div>
          <div class="doc" data-doc="soc"><b>Sociaal verslag / context</b><span>dag 1‚Äì3</span></div>
          <div class="doc" data-doc="discharge"><b>Definitieve ontslagbrief</b><span>laatste 48u</span></div>
          <div class="doc" data-doc="meds"><b>Finale medicatie</b><span>laatste 48u</span></div>
          <div class="doc" data-doc="rx"><b>Voorschriften/attesten</b><span>laatste 48u</span></div>
          <div class="doc" data-doc="appts"><b>Afsprakenlijst</b><span>laatste 48u</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- DUAL FLOW -->
  <section class="panel reveal" id="core">
    <div class="head">
      <div class="title">
        <span class="swatch blue"></span><span>Dubbele flow</span><span class="badge">PHR + vragenlijst</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch blue"></span> Flow 1</span>
        <span class="leg"><span class="swatch purple"></span> Flow 2</span>
        <span class="leg"><span class="swatch amber"></span> Stoplicht</span>
      </div>
    </div>

    <div class="section grid2">
      <!-- FLOW 1 -->
      <div class="block">
        <h3>
          <span>üîµ Flow 1 ‚Äî Documenten ‚Üí OnePatient (Bingli) ‚Üí PHR</span>
          <span class="mini"><span class="tag">gestructureerde medische data</span></span>
        </h3>

        <div class="nodes">
          <div class="node" data-key="f1a">
            <div class="icon blue">
              <svg viewBox="0 0 24 24" fill="none"><path d="M7 3h7l3 3v15H7V3z" stroke="white" stroke-width="2"/><path d="M14 3v4h4" stroke="white" stroke-width="2"/></svg>
            </div>
            <div>
              <b>Upload medische documenten</b>
              <p>Opnameverslag, probleemlijst, evolutie, later ontslagbrief & medicatie.</p>
              <small>Input: PDF/DOCX</small>
            </div>
          </div>

          <div class="arrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 5v14M7 14l5 5 5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>

          <div class="node" data-key="f1b">
            <div class="icon blue">
              <svg viewBox="0 0 24 24" fill="none"><path d="M4 6h16v12H4V6z" stroke="white" stroke-width="2"/><path d="M8 10h8M8 14h6" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div>
              <b>Scrape in OnePatient</b>
              <p>Extractie ‚Üí diagnoses, medicatie, procedures, evolutie (gestructureerd).</p>
              <small>Output: structured fields</small>
            </div>
          </div>

          <div class="arrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 5v14M7 14l5 5 5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>

          <div class="node" data-key="f1c">
            <div class="icon blue">
              <svg viewBox="0 0 24 24" fill="none"><path d="M12 3c4 0 7 3 7 7v8H5V10c0-4 3-7 7-7z" stroke="white" stroke-width="2"/><path d="M9 21h6" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div>
              <b>PHR + gestructureerde medische data</b>
              <p>Episode + historiek ‚Üí basis voor acute √©n chronische flags.</p>
              <small>Continu√Øteit mogelijk</small>
            </div>
          </div>

          <div class="details" id="d_f1">
            <h4>Wat haalt Zorgstart hieruit?</h4>
            <ul>
              <li>Acute episode: diagnose/ingreep/complicaties/follow-up</li>
              <li>Chronische flags: comorbiditeit, polyfarmacie, kwetsbaarheid</li>
              <li>Wijzigingen: medicatieverschillen, nieuwe acties, alarmsymptomen</li>
            </ul>
          </div>

          <div class="flex">
            <button class="btn" data-sim="upload">Simuleer upload</button>
            <button class="btn" data-sim="scrape">Simuleer scrape + PHR</button>
            <button class="btn" data-toggle="d_f1">Details</button>
          </div>
        </div>
      </div>

      <!-- FLOW 2 -->
      <div class="block">
        <h3>
          <span>üü£ Flow 2 ‚Äî Slimme vragenlijst ‚Üí contextuele data</span>
          <span class="mini"><span class="tag">thuisuitvoerbaarheid</span><span class="tag">spoed + opname</span></span>
        </h3>

        <div class="nodes">
          <div class="node" data-key="f2a">
            <div class="icon purple">
              <svg viewBox="0 0 24 24" fill="none"><path d="M4 4h16v16H4V4z" stroke="white" stroke-width="2"/><path d="M7 8h10M7 12h10M7 16h7" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div>
              <b>Adaptieve vragenlijst (3‚Äì5 min)</b>
              <p>Wooncontext, mantelzorg, ADL, hulpmiddelen, veiligheid.</p>
              <small>Input: pati√´nt/mantelzorger/staff</small>
            </div>
          </div>

          <div class="arrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 5v14M7 14l5 5 5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>

          <div class="node" data-key="f2b">
            <div class="icon purple">
              <svg viewBox="0 0 24 24" fill="none"><path d="M12 2a7 7 0 017 7v6H5V9a7 7 0 017-7z" stroke="white" stroke-width="2"/><path d="M8 21h8" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div>
              <b>Contextprofiel + ketenrisico‚Äôs</b>
              <p>THUIS-stoppers vroeg detecteren + randvoorwaarden voor ontslag.</p>
              <small>Output: risk flags</small>
            </div>
          </div>

          <div class="details" id="d_f2">
            <h4>Voorbeeldvragen (kort)</h4>
            <ul>
              <li>Woont u alleen? Is er dagelijks iemand aanwezig?</li>
              <li>Trappen tussen slaapkamer/badkamer/leefruimte?</li>
              <li>Wie beheert medicatie en afspraken?</li>
              <li>Hulpmiddelen nodig (bed/rollator/toilet)?</li>
              <li>Recente vallen? cognitieve verwarring?</li>
            </ul>
          </div>

          <div class="flex">
            <button class="btn" data-sim="questionnaire">Simuleer vragenlijst</button>
            <button class="btn" data-toggle="d_f2">Vragen</button>
          </div>

          <hr class="sep"/>

          <div class="flex" style="justify-content:space-between">
            <div class="lights">
              <span class="kbd">Stoplicht:</span>
              <span class="light med ok" data-l="MED" data-light="med"></span>
              <span class="light hosp ok" data-l="HOSP" data-light="hosp"></span>
              <span class="light home" data-l="THUIS" data-light="home"></span>
              <span class="kbd">klik</span>
            </div>
            <div class="statusLine" id="stopStatus">Status: MED=groen ¬∑ HOSP=groen ¬∑ THUIS=geel</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- LEXICONS + PROBLEEMGEBIEDEN -->
  <section class="panel reveal" id="lex">
    <div class="head">
      <div class="title">
        <span class="swatch purple"></span><span>Lexicons ‚Üí 16 probleemgebieden</span><span class="badge">matchlaag</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch purple"></span> lexicon actief</span>
        <span class="leg"><span class="swatch green"></span> probleemgebied gedetecteerd</span>
      </div>
    </div>

    <div class="section">
      <div class="block" style="padding:12px">
        <h3 style="margin:0 0 10px;position:relative;z-index:1">
          <span>üß† Lexicon selectie (16)</span>
          <span class="mini"><span class="tag">klik</span><span class="tag">of ‚ÄúRun‚Äù</span></span>
        </h3>

        <div class="lexRow" id="lexRow">
          <div class="lex" data-lex="cardio">CARDIO</div>
          <div class="lex" data-lex="resp">RESPIRATOIR</div>
          <div class="lex" data-lex="wound">WOND/POST-OP</div>
          <div class="lex" data-lex="pain">PIJN</div>

          <div class="lex" data-lex="frailty">KWETSBAARHEID</div>
          <div class="lex" data-lex="falls">VALRISICO</div>
          <div class="lex" data-lex="cog">COGNITIE</div>
          <div class="lex" data-lex="mental">MENTALE GEZONDHEID</div>

          <div class="lex" data-lex="nutrition">VOEDING/SLIK</div>
          <div class="lex" data-lex="mobility">MOBILITEIT/REVALIDATIE</div>
          <div class="lex" data-lex="woundsup">DRUKLETSELS</div>
          <div class="lex" data-lex="infection">INFECTIE/AB</div>

          <div class="lex" data-lex="diabetes">DIABETES</div>
          <div class="lex" data-lex="renal">NIERFUNCTIE</div>
          <div class="lex" data-lex="meds">MEDICATIESCHEMA</div>
          <div class="lex" data-lex="social">SOCIAAL/ORGANISATIE</div>
        </div>

        <div class="flex" style="margin-top:12px">
          <button class="btn primary" id="runLex">Run lexicons</button>
          <button class="btn" id="clearLex">Clear</button>
          <span class="kbd" id="lexHint">Tip: simuleer eerst ‚Äúscrape‚Äù + ‚Äúvragenlijst‚Äù voor rijkere matches</span>
        </div>

        <hr class="sep"/>

        <h3 style="margin:0 0 10px;position:relative;z-index:1">üéØ Probleemgebieden (16)</h3>
        <div class="pbGrid" id="pbGrid">
          <div class="pb" data-pb="pb_cardio"><b>Cardio</b><span>hartfalen/ritme</span></div>
          <div class="pb" data-pb="pb_resp"><b>Respiratoir</b><span>COPD/pneumonie</span></div>
          <div class="pb" data-pb="pb_wound"><b>Wondzorg</b><span>post-op/ulcus</span></div>
          <div class="pb" data-pb="pb_pain"><b>Pijn</b><span>analgesie</span></div>

          <div class="pb" data-pb="pb_frailty"><b>Kwetsbaarheid</b><span>ADL/Katz</span></div>
          <div class="pb" data-pb="pb_falls"><b>Valpreventie</b><span>vallen/mobiliteit</span></div>
          <div class="pb" data-pb="pb_cog"><b>Cognitie</b><span>dementie/delier</span></div>
          <div class="pb" data-pb="pb_mental"><b>Mentaal</b><span>angst/depressie</span></div>

          <div class="pb" data-pb="pb_nutrition"><b>Voeding/slik</b><span>malnutritie</span></div>
          <div class="pb" data-pb="pb_mobility"><b>Mobiliteit</b><span>revalidatie</span></div>
          <div class="pb" data-pb="pb_pressure"><b>Drukletsels</b><span>preventie</span></div>
          <div class="pb" data-pb="pb_infection"><b>Infectie/AB</b><span>OPAT/AB</span></div>

          <div class="pb" data-pb="pb_diabetes"><b>Diabetes</b><span>glycemie</span></div>
          <div class="pb" data-pb="pb_renal"><b>Nierfunctie</b><span>monitoring</span></div>
          <div class="pb" data-pb="pb_meds"><b>Medicatieschema</b><span>reconciliatie</span></div>
          <div class="pb" data-pb="pb_social"><b>Sociaal/organisatie</b><span>mantelzorg</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- BUNDLES -->
  <section class="panel reveal" id="bundels">
    <div class="head">
      <div class="title">
        <span class="swatch green"></span><span>16 Zorgbundels</span><span class="badge">suggestie</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch green"></span> bundel actief</span>
        <span class="leg"><span class="swatch purple"></span> probleemgebied</span>
        <span class="leg"><span class="swatch blue"></span> PHR</span>
      </div>
    </div>

    <div class="section">
      <div class="block" style="padding:12px">
        <h3 style="margin:0 0 10px;position:relative;z-index:1">
          <span>üì¶ Bundelvoorstellen (16)</span>
          <span class="mini"><span class="tag">op basis van probleemgebieden</span></span>
        </h3>

        <div class="bundleGrid" id="bundleGrid">
          <div class="bundle" data-b="b_cardio"><b>Hartfalen/Cardio</b><ul><li>Daggewicht + alarmsymptomen</li><li>Vocht/diuretica opvolging</li><li>Huisarts + vpk follow-up</li></ul></div>
          <div class="bundle" data-b="b_resp"><b>Respiratoir</b><ul><li>Inhalatie/zuurstof check</li><li>Alarmtekens & actieplan</li><li>Follow-up + kine</li></ul></div>
          <div class="bundle" data-b="b_wound"><b>Wondzorg/Post-op</b><ul><li>Wondzorg protocol</li><li>Controle tekenen infectie</li><li>Materiaal & planning</li></ul></div>
          <div class="bundle" data-b="b_pain"><b>Pijncontrole</b><ul><li>Schema + doorbraakpijn</li><li>Bijwerkingen monitoren</li><li>Escalatiecriteria</li></ul></div>

          <div class="bundle" data-b="b_frailty"><b>Kwetsbare Oudere</b><ul><li>ADL ondersteuning</li><li>Dagstructuur/veiligheid</li><li>Mantelzorg afstemming</li></ul></div>
          <div class="bundle" data-b="b_falls"><b>Valpreventie</b><ul><li>Risicoscreening thuis</li><li>Hulpmiddelen/trappen</li><li>Oefeningen + ergo</li></ul></div>
          <div class="bundle" data-b="b_cog"><b>Cognitie</b><ul><li>Delier/dementie plan</li><li>Toezicht & veiligheid</li><li>Educatie mantelzorger</li></ul></div>
          <div class="bundle" data-b="b_mental"><b>Mentaal Welzijn</b><ul><li>Screening angst/depressie</li><li>Ondersteuning/doorverwijzing</li><li>Follow-up contactmoment</li></ul></div>

          <div class="bundle" data-b="b_nutrition"><b>Voeding/Slik</b><ul><li>Di√´tetiek + plan</li><li>Gewicht/eiwitinname</li><li>Slikveiligheid (logopedie)</li></ul></div>
          <div class="bundle" data-b="b_mobility"><b>Mobiliteit/Revalidatie</b><ul><li>Kine startdatum</li><li>Transfers/trapveiligheid</li><li>Doelen (week 1‚Äì2)</li></ul></div>
          <div class="bundle" data-b="b_pressure"><b>Drukletselpreventie</b><ul><li>Huidinspectie</li><li>Anti-decubitus materiaal</li><li>Wisselligging</li></ul></div>
          <div class="bundle" data-b="b_infection"><b>Infectie/Antibiotica</b><ul><li>AB schema/duur</li><li>Controle parameters</li><li>Escalatie bij koorts</li></ul></div>

          <div class="bundle" data-b="b_diabetes"><b>Diabetes</b><ul><li>Glycemieplan</li><li>Insuline/medicatie check</li><li>Voeding + follow-up</li></ul></div>
          <div class="bundle" data-b="b_renal"><b>Nierfunctie</b><ul><li>Lab/controle planning</li><li>Hydratatie advies</li><li>Medicatie-aanpassing alert</li></ul></div>
          <div class="bundle" data-b="b_meds"><b>Medicatieschema</b><ul><li>Reconciliatie (voor/na)</li><li>Inname-overzicht (weekbox)</li><li>Interacties/duplicaten check</li></ul></div>
          <div class="bundle" data-b="b_social"><b>Sociaal/Organisatie</b><ul><li>Mantelzorg afspraken</li><li>Hulpmiddelen & vervoer</li><li>Contactlijst + noodplan</li></ul></div>
        </div>

        <div class="flex" style="margin-top:12px">
          <button class="btn primary" id="suggestBundles">Stel bundels voor</button>
          <button class="btn" id="clearBundles">Clear</button>
          <span class="kbd">Klik op bundels om manueel te togglen</span>
        </div>
      </div>
    </div>
  </section>

  <!-- PROVIDERS + MATCHING -->
  <section class="panel reveal" id="providers">
    <div class="head">
      <div class="title">
        <span class="swatch blue"></span><span>Zorgverleners & matching</span><span class="badge">tussenlaag</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch blue"></span> zorgverleners geselecteerd</span>
        <span class="leg"><span class="swatch amber"></span> matching bezig</span>
        <span class="leg"><span class="swatch green"></span> gematcht</span>
      </div>
    </div>

    <div class="section">
      <div class="block" style="padding:12px">
        <h3 style="margin:0 0 10px;position:relative;z-index:1">
          <span>üë©‚Äç‚öïÔ∏è Aangewezen zorgverleners (auto op basis van bundels)</span>
          <span class="mini">
            <span class="tag">Zorgstart ‚Üí Flexizorg</span>
            <span class="tag"><a class="link" href="https://example.com/matchmaking" target="_blank" rel="noopener">matchmakingsplatform</a></span>
          </span>
        </h3>

        <div class="provGrid" id="provGrid">
          <!-- Filled by JS -->
        </div>

        <div class="flex" style="margin-top:12px">
          <button class="btn primary" id="buildProviders">Genereer zorgverleners</button>
          <button class="btn" id="startMatching">Start matching (sim)</button>
          <button class="btn" id="clearProviders">Clear</button>
          <span class="kbd" id="matchHint">Matching verschijnt per rol (zoeken ‚Üí gematcht)</span>
        </div>
      </div>
    </div>
  </section>

  <!-- PUBLICATIE -->
  <section class="panel reveal" id="publishPanel">
    <div class="head">
      <div class="title">
        <span class="swatch green"></span><span>Publicatie ‚Üí Zorgplan</span><span class="badge">output</span>
      </div>
      <div class="legend">
        <span class="leg"><span class="swatch purple"></span> probleemgebieden</span>
        <span class="leg"><span class="swatch green"></span> bundels</span>
        <span class="leg"><span class="swatch blue"></span> zorgverleners</span>
      </div>
    </div>

    <div class="section">
      <div class="block" style="padding:12px">
        <h3 style="margin:0 0 10px;position:relative;z-index:1">
          <span>‚úÖ Publiceer (demo)</span>
          <span class="mini"><span class="tag">v1 ‚Üí v2 ‚Üí definitief</span><span class="tag">medicatieschema inbegrepen</span></span>
        </h3>

        <div class="flex">
          <button class="btn primary" id="publish">Publiceer zorgplan</button>
          <button class="btn" id="hidePublish">Verberg output</button>
          <span class="kbd">Publicatie toont plan + uitvoering + matching</span>
        </div>

        <div class="publishBox" id="publishBox">
          <h4>üìÑ Zorgplan-output (demo)</h4>
          <div class="row">
            <div class="outCard">
              <b>Samenvatting</b>
              <p id="planText">‚Äî</p>
            </div>
            <div class="outCard">
              <b>Uitvoering & zorgverleners</b>
              <p id="execText">‚Äî</p>
            </div>
          </div>
          <p class="smallNote" style="margin:10px 0 0">
            Volgende stap: publicatie kan automatisch ‚Äújobs‚Äù aanmaken richting het matchmakingsplatform (Flexizorg) en opvolging via Nurseline.
          </p>
        </div>
      </div>
    </div>
  </section>

  <footer class="reveal" style="margin-top:18px;color:var(--muted);font-size:12px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;opacity:.9;">
    <div>¬© Zorgstart demo-schema ‚Äî 16 probleemgebieden + 16 bundels + zorgverleners + matching</div>
    <div><span class="kbd">Tip</span> Klik op ‚ÄúSimuleer demo‚Äù</div>
  </footer>
</div>

<script>
/* ---------- Reveal ---------- */
const revealEls = Array.from(document.querySelectorAll('.reveal'));
const io = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if(e.isIntersecting){
      e.target.classList.add('in');
      io.unobserve(e.target);
    }
  });
}, { threshold: 0.12 });
revealEls.forEach(el => io.observe(el));

/* ---------- Focus + Reset ---------- */
document.getElementById('toggleFocus').addEventListener('click', () => document.body.classList.toggle('focus'));

function clearActive(){
  document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
}
function clearState(){
  clearActive();
  document.querySelectorAll('.doc').forEach(d => d.classList.remove('on'));
  setLight('med', true);
  setLight('hosp', true);
  setLight('home', false);
  updateStopStatus();

  document.querySelectorAll('.lex').forEach(l => l.classList.remove('on'));
  document.querySelectorAll('.pb').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.bundle').forEach(b => b.classList.remove('on'));

  providersState = {};
  renderProviders([]);

  document.getElementById('publishBox').classList.remove('show');
  document.getElementById('planText').textContent = '‚Äî';
  document.getElementById('execText').textContent = '‚Äî';

  document.querySelectorAll('.details').forEach(d => d.classList.remove('show'));
}
document.getElementById('reset').addEventListener('click', clearState);

/* ---------- Details toggles ---------- */
document.querySelectorAll('[data-toggle]').forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.getAttribute('data-toggle');
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.toggle('show');
    el.classList.add('pulse');
    setTimeout(()=>el.classList.remove('pulse'), 900);
  });
});

/* ---------- Element click highlight ---------- */
document.querySelectorAll('.node, .doc, .lex, .pb, .bundle').forEach(el => {
  el.addEventListener('click', () => {
    el.classList.add('active');
    el.classList.add('pulse');
    setTimeout(()=>el.classList.remove('pulse'), 900);
  });
});

/* ---------- Timeline docs ---------- */
const daySlider = document.getElementById('day');
const dayLabel = document.getElementById('dayLabel');
const docRules = {
  opname: d => d >= 0,
  problem: d => d >= 1,
  nursing: d => d >= 2,
  paramed: d => d >= 3,
  soc: d => d >= 2,
  discharge: d => d >= 12,
  meds: d => d >= 12,
  rx: d => d >= 12,
  appts: d => d >= 12
};
function applyDocs(day){
  document.querySelectorAll('.doc').forEach(doc => {
    const key = doc.getAttribute('data-doc');
    const on = docRules[key] ? docRules[key](day) : false;
    doc.classList.toggle('on', !!on);
  });
}
daySlider.addEventListener('input', () => {
  const d = Number(daySlider.value);
  dayLabel.textContent = `Dag ${d}`;
  applyDocs(d);
});

/* ---------- Stoplights ---------- */
const stopStatus = document.getElementById('stopStatus');
function setLight(which, ok){
  const el = document.querySelector(`.light[data-light="${which}"]`);
  if(!el) return;
  el.classList.toggle('ok', !!ok);
}
function isLightOk(which){
  const el = document.querySelector(`.light[data-light="${which}"]`);
  return el ? el.classList.contains('ok') : false;
}
function updateStopStatus(){
  const med = isLightOk('med') ? 'groen' : 'geel';
  const hosp = isLightOk('hosp') ? 'groen' : 'geel';
  const home = isLightOk('home') ? 'groen' : 'geel';
  stopStatus.textContent = `Status: MED=${med} ¬∑ HOSP=${hosp} ¬∑ THUIS=${home}`;
}
document.querySelectorAll('.light').forEach(l => {
  l.addEventListener('click', () => {
    l.classList.toggle('ok');
    updateStopStatus();
  });
});

/* ---------- Lexicon -> Probleemgebied mapping (16) ---------- */
const lexToPb = {
  cardio: ['pb_cardio'],
  resp: ['pb_resp'],
  wound: ['pb_wound'],
  pain: ['pb_pain'],
  frailty: ['pb_frailty'],
  falls: ['pb_falls'],
  cog: ['pb_cog'],
  mental: ['pb_mental'],
  nutrition: ['pb_nutrition'],
  mobility: ['pb_mobility'],
  woundsup: ['pb_pressure'],
  infection: ['pb_infection'],
  diabetes: ['pb_diabetes'],
  renal: ['pb_renal'],
  meds: ['pb_meds'],
  social: ['pb_social']
};

function clearPb(){ document.querySelectorAll('.pb').forEach(p => p.classList.remove('on')); }
function setPb(pbKey, on){
  const el = document.querySelector(`.pb[data-pb="${pbKey}"]`);
  if(el) el.classList.toggle('on', !!on);
}
document.querySelectorAll('.lex').forEach(l => {
  l.addEventListener('click', () => l.classList.toggle('on'));
});
document.getElementById('clearLex').addEventListener('click', () => {
  document.querySelectorAll('.lex').forEach(l => l.classList.remove('on'));
  clearPb();
});
document.getElementById('runLex').addEventListener('click', () => {
  clearPb();
  document.querySelectorAll('.lex.on').forEach(l => {
    const k = l.getAttribute('data-lex');
    (lexToPb[k] || []).forEach(pb => setPb(pb, true));
  });
  // Context-infer: als THUIS niet groen -> sociaal + frailty + falls
  if(!isLightOk('home')){
    setPb('pb_social', true);
    setPb('pb_frailty', true);
    setPb('pb_falls', true);
  }
  // Als polyfarmacie/medicatie relevant: toon medicatieschema als extra waarheidslaag (demo)
  const medsLexOn = document.querySelector('.lex[data-lex="meds"]').classList.contains('on');
  const polyHint = document.querySelector('.lex[data-lex="renal"]').classList.contains('on') ||
                   document.querySelector('.lex[data-lex="diabetes"]').classList.contains('on');
  if(medsLexOn || polyHint){
    setPb('pb_meds', true);
  }
});

/* ---------- Bundles suggestions (16) ---------- */
const pbToBundle = {
  pb_cardio: 'b_cardio',
  pb_resp: 'b_resp',
  pb_wound: 'b_wound',
  pb_pain: 'b_pain',
  pb_frailty: 'b_frailty',
  pb_falls: 'b_falls',
  pb_cog: 'b_cog',
  pb_mental: 'b_mental',
  pb_nutrition: 'b_nutrition',
  pb_mobility: 'b_mobility',
  pb_pressure: 'b_pressure',
  pb_infection: 'b_infection',
  pb_diabetes: 'b_diabetes',
  pb_renal: 'b_renal',
  pb_meds: 'b_meds',
  pb_social: 'b_social'
};

function clearBundles(){ document.querySelectorAll('.bundle').forEach(b => b.classList.remove('on')); }
function setBundle(bKey, on){
  const el = document.querySelector(`.bundle[data-b="${bKey}"]`);
  if(el) el.classList.toggle('on', !!on);
}
document.getElementById('suggestBundles').addEventListener('click', () => {
  clearBundles();
  const pbsOn = Array.from(document.querySelectorAll('.pb.on')).map(p => p.getAttribute('data-pb'));
  pbsOn.forEach(pb => setBundle(pbToBundle[pb], true));
  // Medicatieschema bundel mee activeren als diabetes/renal/cardiac actief (demo)
  const mustMeds = ['pb_diabetes','pb_renal','pb_cardio','pb_cog'].some(k => pbsOn.includes(k));
  if(mustMeds) setBundle('b_meds', true);
});
document.getElementById('clearBundles').addEventListener('click', clearBundles);

/* ---------- Providers layer (mapping bundles -> roles) ---------- */
const roleCatalog = {
  nurse:   {title:'Thuisverpleegkundige', meta:'Rol: VPK', reason:'Zorguitvoering + opvolging + educatie + signalering'},
  physio:  {title:'Kinesitherapeut', meta:'Rol: Kine', reason:'Mobiliteit, ademhaling, revalidatie'},
  ergo:    {title:'Ergotherapeut', meta:'Rol: Ergo', reason:'Valpreventie, hulpmiddelen, woningadvies'},
  gp:      {title:'Huisarts', meta:'Rol: GP', reason:'Medische opvolging, medicatiebeslissingen, continu√Øteit'},
  pharm:   {title:'Apotheker', meta:'Rol: Apotheek', reason:'Medicatieschema, reconciliatie, interacties, weekbox'},
  diet:    {title:'Di√´tist', meta:'Rol: Di√´tetiek', reason:'Voeding, eiwit, diabetes-educatie'},
  speech:  {title:'Logopedist', meta:'Rol: Logopedie', reason:'Slikveiligheid, communicatie'},
  psych:   {title:'Psycholoog', meta:'Rol: Mentaal', reason:'Angst/depressie, coping, nazorg'},
  social:  {title:'Maatschappelijk werker', meta:'Rol: Sociaal', reason:'Mantelzorg, voorzieningen, administratie'},
  wound:   {title:'Wondzorgspecialist', meta:'Rol: Wondexpert', reason:'Complexe wonden, materiaal, protocol'},
  aide:    {title:'Zorgkundige / gezinszorg', meta:'Rol: ADL', reason:'ADL-ondersteuning, dagstructuur'},
  equip:   {title:'Hulpmiddelenleverancier', meta:'Rol: Materiaal', reason:'Levering bed/rolstoel/toilet/anti-decubitus'}
};

const bundleToRoles = {
  b_cardio:   ['nurse','gp','pharm'],
  b_resp:     ['physio','gp','nurse'],
  b_wound:    ['wound','nurse','equip'],
  b_pain:     ['gp','pharm','nurse'],
  b_frailty:  ['aide','nurse','social'],
  b_falls:    ['ergo','physio','equip'],
  b_cog:      ['social','gp','nurse'],
  b_mental:   ['psych','gp','social'],
  b_nutrition:['diet','speech','gp'],
  b_mobility: ['physio','ergo','equip'],
  b_pressure: ['nurse','equip','aide'],
  b_infection:['nurse','gp','pharm'],
  b_diabetes: ['nurse','gp','diet','pharm'],
  b_renal:    ['gp','pharm','nurse'],
  b_meds:     ['pharm','gp','nurse'],
  b_social:   ['social','equip','aide']
};

let providersState = {}; // roleKey -> {status: 'idle'|'matching'|'matched'|'blocked'}

function unique(arr){ return Array.from(new Set(arr)); }

function computeRolesFromBundles(){
  const bundlesOn = Array.from(document.querySelectorAll('.bundle.on')).map(b => b.getAttribute('data-b'));
  const roles = [];
  bundlesOn.forEach(b => (bundleToRoles[b] || []).forEach(r => roles.push(r)));
  return unique(roles);
}

function renderProviders(roleKeys){
  const grid = document.getElementById('provGrid');
  grid.innerHTML = '';
  roleKeys.forEach(rk => {
    const base = roleCatalog[rk] || {title:rk, meta:'', reason:''};
    const st = providersState[rk]?.status || 'idle';
    const statusLabel = st === 'idle' ? 'klaar voor matching'
      : st === 'matching' ? 'matching‚Ä¶'
      : st === 'matched' ? 'gematcht'
      : 'geblokkeerd';

    const div = document.createElement('div');
    div.className = `prov ${st === 'matching' ? 'matching' : ''} ${st === 'matched' ? 'matched' : ''} ${st === 'blocked' ? 'blocked' : ''} on`;
    div.innerHTML = `
      <b>${base.title}</b>
      <div class="meta">${base.meta}</div>
      <div class="reason">${base.reason}</div>
      <div class="status"><span class="pilldot"></span>${statusLabel}</div>
    `;
    grid.appendChild(div);
  });

  if(roleKeys.length === 0){
    grid.innerHTML = `<div class="prov on"><b>Geen zorgverleners geselecteerd</b><div class="meta">Tip</div><div class="reason">Stel eerst bundels voor, daarna ‚ÄúGenereer zorgverleners‚Äù.</div><div class="status"><span class="pilldot"></span>idle</div></div>`;
  }
}

document.getElementById('buildProviders').addEventListener('click', () => {
  const roles = computeRolesFromBundles();
  roles.forEach(r => providersState[r] = providersState[r] || {status:'idle'});
  renderProviders(roles);
});

document.getElementById('clearProviders').addEventListener('click', () => {
  providersState = {};
  renderProviders([]);
});

document.getElementById('startMatching').addEventListener('click', () => {
  const roles = computeRolesFromBundles();
  if(roles.length === 0){ renderProviders([]); return; }

  // set all to matching
  roles.forEach(r => providersState[r] = {status:'matching'});
  renderProviders(roles);

  // resolve after short delays (demo)
  roles.forEach((r, i) => {
    setTimeout(() => {
      // simple rule: if THUIS not ok, some roles may be blocked (demo)
      const homeOk = isLightOk('home');
      const blocked = (!homeOk && (r === 'equip' || r === 'aide')) ? true : false;
      providersState[r] = {status: blocked ? 'blocked' : 'matched'};
      renderProviders(roles);
    }, 450 + i * 160);
  });
});

/* ---------- Publish output ---------- */
function listOn(selector, attr){
  return Array.from(document.querySelectorAll(selector))
    .filter(el => el.classList.contains('on'))
    .map(el => el.getAttribute(attr));
}
function pbTitles(){
  return Array.from(document.querySelectorAll('.pb.on')).map(pb => pb.querySelector('b').textContent.trim());
}
function bundleTitles(){
  return Array.from(document.querySelectorAll('.bundle.on')).map(b => b.querySelector('b').textContent.trim());
}

function buildPlanText(){
  const pbs = pbTitles();
  const buns = bundleTitles();
  const stop = `Keten: MED=${isLightOk('med')?'groen':'geel'}, HOSP=${isLightOk('hosp')?'groen':'geel'}, THUIS=${isLightOk('home')?'groen':'geel'}.`;

  const medsIncluded = buns.some(x => x.toLowerCase().includes('medicatie'));
  const medsLine = medsIncluded
    ? 'Medicatie: reconciliatie + inname-overzicht + apotheek/GP-afstemming inbegrepen.'
    : 'Medicatie: geen aparte bundel geactiveerd (kan automatisch geactiveerd worden bij polyfarmacie/diabetes/renal/cognitie).';

  if(buns.length === 0){
    return `Geen bundels geselecteerd. Run lexicons ‚Üí stel bundels voor ‚Üí genereer zorgverleners ‚Üí publiceer. ${stop}`;
  }
  return `Probleemgebieden: ${pbs.join(' ¬∑ ')}. Zorgbundels: ${buns.join(' ¬∑ ')}. ${medsLine} ${stop} Versie: voorlopig (v1) ‚Üí finaliseren met ontslagbrief + finale medicatie + voorschriften.`;
}

function buildExecText(){
  const roles = computeRolesFromBundles();
  const roleNames = roles.map(r => roleCatalog[r]?.title || r);
  const homeOk = isLightOk('home');

  const matchingSummary = roles.length
    ? roles.map(r => {
        const st = providersState[r]?.status || 'idle';
        const label = st === 'matched' ? 'gematcht' : st === 'matching' ? 'matching' : st === 'blocked' ? 'geblokkeerd' : 'klaar';
        return `${(roleCatalog[r]?.title||r)}=${label}`;
      }).join(' ¬∑ ')
    : 'geen';

  const top = homeOk
    ? 'Uitvoering: startdata vastleggen + opdrachten publiceren naar matchmakingsplatform.'
    : '‚ö† THUIS geel: eerst thuisorganisatie (mantelzorg/hulpmiddelen/veiligheid) oplossen v√≥√≥r activatie.';

  return `${top}
Zorgverleners: ${roleNames.length ? roleNames.join(', ') : '‚Äî'}.
Matching: ${matchingSummary}.
Verwijzing: publiceer jobs naar het matchmakingsplatform (Flexizorg) + opvolging via Nurseline.`;
}

document.getElementById('publish').addEventListener('click', () => {
  document.getElementById('planText').textContent = buildPlanText();
  document.getElementById('execText').textContent = buildExecText();
  const box = document.getElementById('publishBox');
  box.classList.add('show');
  box.scrollIntoView({behavior:'smooth', block:'start'});
});
document.getElementById('hidePublish').addEventListener('click', () => {
  document.getElementById('publishBox').classList.remove('show');
});

/* ---------- Simulations ---------- */
function setLexOn(lex, on){
  const el = document.querySelector(`.lex[data-lex="${lex}"]`);
  if(el) el.classList.toggle('on', !!on);
}
function pulseKey(key){
  const el = document.querySelector(`.node[data-key="${key}"]`);
  if(!el) return;
  el.classList.add('active');
  el.classList.add('pulse');
  setTimeout(()=>el.classList.remove('pulse'), 900);
}
function showDetails(id){
  const el = document.getElementById(id);
  if(el) el.classList.add('show');
}
document.querySelectorAll('[data-sim]').forEach(btn => {
  btn.addEventListener('click', () => {
    const k = btn.getAttribute('data-sim');
    if(k === 'upload'){
      daySlider.value = 1; dayLabel.textContent = 'Dag 1'; applyDocs(1);
      pulseKey('f1a');
    }
    if(k === 'scrape'){
      // simulate that medical data suggests: cardio + meds + infection + wound (demo)
      setLexOn('cardio', true);
      setLexOn('meds', true);
      setLexOn('infection', true);
      setLexOn('wound', true);
      pulseKey('f1b');
      showDetails('d_f1');
    }
    if(k === 'questionnaire'){
      // make THUIS yellow for demo + suggest frailty/social/falls
      setLight('home', false); updateStopStatus();
      setLexOn('frailty', true);
      setLexOn('social', true);
      setLexOn('falls', true);
      pulseKey('f2a');
      showDetails('d_f2');
    }
  });
});

document.getElementById('simulateAll').addEventListener('click', () => {
  clearState();
  // timeline baseline
  daySlider.value = 2; dayLabel.textContent = 'Dag 2'; applyDocs(2);
  // simulate both flows
  setTimeout(() => { pulseKey('f1a'); }, 120);
  setTimeout(() => {
    setLexOn('cardio', true);
    setLexOn('meds', true);
    setLexOn('infection', true);
    setLexOn('wound', true);
    pulseKey('f1b');
  }, 320);
  setTimeout(() => {
    setLight('home', false);
    updateStopStatus();
    setLexOn('frailty', true);
    setLexOn('social', true);
    setLexOn('falls', true);
    pulseKey('f2a');
  }, 520);
  // run lex -> suggest bundles -> providers -> matching -> publish
  setTimeout(() => document.getElementById('runLex').click(), 720);
  setTimeout(() => document.getElementById('suggestBundles').click(), 900);
  setTimeout(() => document.getElementById('buildProviders').click(), 1080);
  setTimeout(() => document.getElementById('startMatching').click(), 1260);
  setTimeout(() => document.getElementById('publish').click(), 1700);
});

/* ---------- init ---------- */
function init(){
  applyDocs(Number(daySlider.value));
  updateStopStatus();
  renderProviders([]);
}
init();
</script>
</body>
</html>
